
<h2 class="box-size mb-4">
  <i class="fa-solid fa-piggy-bank" style="color: #000000ff;"></i>
  Your Piggy Banks
</h2>
<%= render "users/balance_box" %>

<div id="saving_list" class="box-size mb-4 rounded-5 shadow-sm p-3 bg-white">
  <% @savings.each do |saving| %>
    <% pct = [saving.progress_pct, 100].min %>
    <div class="rounded-3 p-3 mb-3 border bg-white">
      <!-- Top row: Title + inline deposit form -->
      <div class="d-flex justify-content-between align-items-center gap-2 flex-wrap">
        <div class="fw-bold fs-5"><%= saving.title %></div>
        <%= form_with url: deposits_saving_path(saving), method: :post, local: true,
                      class: "d-flex w-100 gap-2 align-items-center" do |f| %>
          <div class="input-group input-group-sm flex-grow-1">
            <span class="input-group-text">¥</span>
            <%= f.number_field :amount, min: 1, step: 1, placeholder: "Amount",
                               class: "form-control", required: true %>
          </div>
          <!-- keep date but hide it -->
          <%= f.hidden_field :date, value: Date.current %>
          <%= f.submit "Add", class: "btn btn-success text-white btn-sm rounded-5 px-4" %>
        <% end %>
      </div>
      <!-- Progress + Saved/Goal block -->
      <div class="mt-2">
        <!-- Progress bar with centered % -->
        <div class="progress position-relative mt-3" style="height:16px;border-radius:8px;">
          <% bar_class =
        if saving.progress_pct >= 100
          "bg-success"
        elsif saving.progress_pct >= 50
          "bg-warning"
        else
          "bg-danger"
        end %>
          <div class="progress-bar <%= bar_class %>"
         role="progressbar"
         style="width:<%= pct %>%"
         aria-valuenow="<%= pct %>" aria-valuemin="0" aria-valuemax="100">
          </div>
          <!-- centered % overlay -->
          <span class="position-absolute top-50 start-50 translate-middle small fw-bold">
            <%= pct %>%
          </span>
        </div>
        <!-- Saved (left) and Goal (right) on same line -->
        <div class="d-flex justify-content-between small text-muted mt-2">
          <span>
            <strong>Saved:</strong>
            <%= number_to_currency(saving.amount_saved, unit: "¥", precision: 0, delimiter: ",") %>
          </span>
          <span class="text-end">
            <strong>Goal:</strong>
            <%= number_to_currency(saving.goal, unit: "¥", precision: 0, delimiter: ",") %>
          </span>
        </div>
      </div>
    </div>
  <% end %>
</div>
<!-- New Saving form -->
<div id="add_new_saving" class="box-size rounded-5 shadow-sm p-3 bg-white">
  <h3 class="mb-3">New Piggy Bank</h3>
  <%= simple_form_for @saving, url: savings_path, html: { class: "row g-2 align-items-end" } do |f| %>
    <!-- Name -->
    <div class="col-12 col-sm">
      <%= f.input_field :title,
            required: true,
            placeholder: "Name (e.g., Trip to Nepal)",
            class: "form-control form-control-sm",
            aria: { label: "Piggy bank name" } %>
    </div>
    <!-- Goal with ¥ prefix -->
    <div class="col-12 col-sm-auto">
      <div class="input-group input-group-sm">
        <span class="input-group-text">¥</span>
        <%= f.number_field :goal,
              min: 1, step: 1, required: true,
              placeholder: "Goal",
              class: "form-control",
              aria: { label: "Goal amount in yen" } %>
      </div>
    </div>
    <!-- Submit -->
    <div class="col-12 col-sm-auto">
      <%= f.button :submit, "Create", class: "btn btn-success btn-sm rounded-5 px-4 text-white" %>
    </div>
  <% end %>
</div>
<div class="pb-5">
</div>
