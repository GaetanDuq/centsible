<h2 class="box-size mb-4">Your Piggy Banks
  <i class="fa-solid fa-piggy-bank" style="color: #000000ff;"></i>
</h2>
<div id="saving_list" class="box-size mb-4 rounded-5 shadow-sm p-3 bg-white">
  <% @savings.each do |saving| %>
    <% pct = [saving.progress_pct, 100].min %>
    <div class="rounded-3 p-3 mb-3 border bg-white">
      <!-- Top row: Title + inline deposit form -->
      <div class="d-flex justify-content-between align-items-center gap-2 flex-wrap">
        <div class="fw-bold fs-5"><%= saving.title %></div>
        <!-- Deposit form (inline, compact) -->
        <%= form_with url: deposits_saving_path(saving), method: :post, local: true, class: "d-flex flex-wrap gap-2 align-items-center" do |f| %>
          <div class="input-group input-group-sm" style="width: 240px;">
            <span class="input-group-text">¥</span>
            <%= f.number_field :amount, min: 1, step: 1, placeholder: "Amount", class: "form-control", required: true %>
          </div>
          <%= f.date_field :date, value: Date.current, class: "form-control form-control-sm", style: "width: 160px;" %>
          <%= f.submit "Add", class: "btn btn-primary btn-sm rounded-5" %>
        <% end %>
      </div>
      <!-- Details row -->
      <div class="small text-muted mt-2">
        Goal:
        <%= number_to_currency(saving.goal, unit: "¥", precision: 0, delimiter: ",") %>
        · Saved:
        <%= number_to_currency(saving.amount_saved, unit: "¥", precision: 0, delimiter: ",") %>
        · <%= saving.progress_pct %>% complete
      </div>
      <!-- Progress bar -->
      <div class="progress mt-2" style="height: 10px;">
        <% bar_class =
            if saving.progress_pct >= 100
              "bg-green"
            elsif saving.progress_pct >= 50
              "bg-warning"
            else
              "bg-danger"
            end %>
        <div class="progress-bar <%= bar_class %>"
            role="progressbar"
            style="width: <%= pct %>%"
            aria-valuenow="<%= pct %>" aria-valuemin="0" aria-valuemax="100">
          <span class="visually-hidden"><%= pct %>%</span>
        </div>
      </div>
    </div>
  <% end %>
</div>
<!-- New Saving form -->
<div id="add_new_saving" class="box-size rounded-5 shadow-sm p-3 bg-white">
  <h3 class="mb-3">Add a New Saving</h3>
  <%= simple_form_for @saving, url: savings_path do |f| %>
    <div class="d-flex gap-2 align-items-end">
      <%= f.input :title, required: true, label: "Saving name" %>
      <%= f.input :goal,  required: true, label: "Goal (¥)", input_html: { type: "number", min: 1, step: 1 } %>
      <%= f.button :submit, "Create", class: "btn btn-success mb-3 rounded-5" %>
    </div>
  <% end %>
</div>
