<%# HEADER PARTIAL %>

<div class="box-size">
<%= render "users/balance_box" %>
</div>
<%# HEADER PARTIAL %>

<%# NAV BAR %>
<div class="box-size">
  <% filtered_totals = @category_totals.reject { |title, _| title == "Income" } %>
  <%= pie_chart filtered_totals, colors: Category::COLORS, library: { pieSliceText: 'value' } %>
</div>

<%# Transactions by Category - Collapsible Cards %>
<div class="box-size container mt-4">
  <% @transactions.each_with_index do |(category, transactions), index| %>
    <% next if category.title == "Income" || transactions.empty? %>
    <% category_total = transactions.sum(&:amount) %>
    <div class="card mb-2 rounded-4">
      <div class="card-header rounded-3" id="heading-<%= category.id %>">
        <h5 class="mb-0">
          <button class="btn text-dark text-decoration-none d-flex justify-content-between align-items-center w-100 rounded-3" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-<%= category.id %>" aria-expanded="false" aria-controls="collapse-<%= category.id %>">
            <!-- Left side: icon -->
            <span class="me-2"><i class="fa-solid fa-angles-down fa-xs"></i></span>
            <span class="me-2"><strong><%= category.title %></strong></span>
            <!-- Right side: total sum -->
            <div class="d-flex ms-auto">
              <span>¥<%= category_total %></span>
            </div>
          </button>
        </h5>
      </div>
      <div id="collapse-<%= category.id %>" class="collapse" aria-labelledby="heading-<%= category.id %>">
        <div class="card-category p-2">
          <% transactions.each do |transaction| %>
            <div class="d-flex justify-content-between py-1">
              <div><%= transaction.description %></div>
              <div>¥<%= transaction.amount %></div>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  <% end %>
</div>
