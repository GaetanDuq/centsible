
<%# HEADER PARTIAL %>
<div class="box-size">
  <h2>Budget</h2>
</div>
<%# HEADER PARTIAL %>
<%# making colors same to piechart and the dropdown  %>
<% category_colors = {} %>
<% @category_totals.each_with_index do |(title, _), index| %>
  <% next if title == "Income" %>
  <% category_colors[title] = Category::COLORS[index] %>
<% end %>
<%# making colors same to piechart and the dropdown  %>
<%# NAV BAR %>


<%# Sorting the categories by amount %>
<% sorted_transactions = @transactions.reject { |category, transactions| category.title == "Income" || transactions.empty? }.sort_by { |category, transactions| -transactions.sum(&:amount) } %>
<%# Sorting the categories %>
<div class="box-size">


<% sorted_transactions.each do |(category, transactions)| %>
  <% next if category.title == "Income" || transactions.empty? %>
  <% total = transactions.sum(&:amount) %>
  <% limit = category.limit %>
  <% remaining = [limit - total, 0].max %>
  <% percentage = [(total.to_f / limit) * 100, 100].min %>
  <% bar_color = category_colors[category.title] || "#007bff" %>

  <div class="mb-4 p-3 bg-white rounded shadow-sm">
    <div class="d-flex justify-content-between align-items-center mb-1">
      <div class="d-flex align-items-center">
<%# icon %>
        <div class="me-2">
          <i class="fa fa-circle" style="color: <%= bar_color %>;"></i>
        </div>
        <strong><%= category.title %></strong>
      </div>
      <div class="text-muted">Limit- 짜<%= number_with_delimiter(limit) %></div>
    </div>

    <div class="progress" style="height: 10px;">
      <div
        class="progress-bar"
        role="progressbar"
        style="width: <%= percentage %>%; background-color: <%= bar_color %>;"
        aria-valuenow="<%= percentage %>"
        aria-valuemin="0"
        aria-valuemax="100"
      ></div>
    </div>

    <div class="d-flex justify-content-between mt-1 small text-muted">
<% if total >= limit %>
      <div style="color: #FF5733">Total spent- 짜<%= number_with_delimiter(total) %></div>
      <% else %>
      <div class="text-primary">Total spent- 짜<%= number_with_delimiter(total) %></div>
<% end %>

      <div>Remaining- 짜<%= number_with_delimiter(remaining) %></div>
    </div>
  </div>
<% end %>
<div class="box-size">
